require(lme4)
str(Dyestuff)
library(lattice)
plot(Dyestuff)
xyplot(Yield~Batch,Dyestuff)

print(dotplot(reorder(Batch, Yield) ~ Yield, Dyestuff,
              ylab = "Batch", jitter.y = TRUE, pch = 21,
              xlab = "Yield of dyestuff (grams of standard color)",
              type = c("p", "a")))

fm01 <- lmer(Yield ~ 1 + (1|Batch), Dyestuff)
fm01

## Notice that the Residual variability between Batch-es in the Random
## effects...

#Random effects:
 #   Groups   Name        Std.Dev.
#Batch    (Intercept) 42.00   
#Residual             49.51 

# The Residual of the the Rand. Effects is: # 49.51, while 
# The square root of the quadratic mean of SD's is:

sd_Batch <- vector()
for(i in levels(Dyestuff[,1])){
    sd_Batch[i] <- sd(Dyestuff[Dyestuff$Batch==i,'Yield'])
}

sqrt(sum(sd_Batch^2)/nlevels(Dyestuff$Batch))
#[1] 49.5101

# The Random Eff variance (Intercept) is:

Batch_Means <- vector()
for(i in levels(Dyestuff[,1])){
Batch_Means[i] <- mean(Dyestuff[Dyestuff$Batch==i,"Yield"])
}

sd(Batch_Means)
